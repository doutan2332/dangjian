{"ast":null,"code":"import Vue from 'vue';\nimport VueRouter from 'vue-router';\nimport Home from '../views/Home';\nimport Index from '../views/Index';\nimport axios from \"../axios\";\nimport store from \"@/store\";\nVue.use(VueRouter);\nconst routes = [{\n  path: '/',\n  name: 'home',\n  component: Home,\n  children: [{\n    path: '/index',\n    name: 'Index',\n    meta: {\n      title: \"首页\"\n    },\n    component: Index\n  }, {\n    path: '/sys/userCenter',\n    name: 'UserCenter',\n    meta: {\n      title: \"个人中心\"\n    },\n    component: () => import('../views/sys/UserCenter')\n  }]\n}, {\n  path: '/login',\n  name: 'login',\n  component: () => import('../views/Login.vue')\n}];\nconst router = new VueRouter({\n  mode: 'history',\n  base: process.env.BASE_URL,\n  routes\n});\nrouter.beforeEach((to, from, next) => {\n  let hasRoute = store.state.menus.hasRoute;\n  let token = localStorage.getItem(\"token\");\n  if (to.path == '/login') {\n    next();\n  } else if (!token) {\n    next({\n      path: '/login'\n    });\n  } else if (token && !hasRoute) {\n    axios.get(\"/sys/menu/nav\", {\n      headers: {\n        Authorization: localStorage.getItem(\"token\")\n      }\n    }).then(res => {\n      //拿到menuList\n      store.commit(\"setMenuList\", res.data.data.nav);\n      //拿到用户权限，用于按钮的点击\n      store.commit(\"setPermList\", res.data.data.authorities);\n\n      //动态绑定路由\n      let newRoutes = router.options.routes;\n      res.data.data.nav.forEach(menu => {\n        if (menu.children) {\n          menu.children.forEach(e => {\n            //转换成路由\n            let route = menuToRoute(e);\n            //把路由添加到路由管理中\n            if (route) {\n              newRoutes[0].children.push(route);\n            }\n          });\n        }\n      });\n      router.addRoutes(newRoutes);\n      hasRoute = true;\n      store.commit(\"changeRouteStatus\", hasRoute);\n    }).catch(err => {\n      console.log(err);\n    });\n  }\n  next();\n});\nconst menuToRoute = menu => {\n  if (!menu.component) {\n    return null;\n  }\n  let route = {\n    name: menu.name,\n    path: menu.path,\n    meta: {\n      icon: menu.icon,\n      title: menu.title\n    }\n  };\n  route.component = () => import('@/views/' + menu.component + '.vue');\n  return route;\n};\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","Home","Index","axios","store","use","routes","path","name","component","children","meta","title","router","mode","base","process","env","BASE_URL","beforeEach","to","from","next","hasRoute","state","menus","token","localStorage","getItem","get","headers","Authorization","then","res","commit","data","nav","authorities","newRoutes","options","forEach","menu","e","route","menuToRoute","push","addRoutes","catch","err","console","log","icon"],"sources":["/Users/wulinxin/Desktop/2024056950参赛总文件/2024056950-02素材与源码/2024056950管理后台代码/vueadmin-vue/vueadmin-vue/src/router/index.js"],"sourcesContent":["import Vue from 'vue'\nimport VueRouter from 'vue-router'\nimport Home from '../views/Home'\nimport Index from '../views/Index'\n\nimport axios from \"../axios\";\nimport store from \"@/store\";\n\nVue.use(VueRouter)\n\nconst routes = [\n  {\n    path: '/',\n    name: 'home',\n    component: Home,\n    children: [\n      {\n        path: '/index',\n        name: 'Index',\n        meta: {\n          title: \"首页\"\n        },\n        component: Index\n      },\n      {\n        path: '/sys/userCenter',\n        name: 'UserCenter',\n        meta: {\n          title: \"个人中心\"\n        },\n        component: ()=>import('../views/sys/UserCenter')\n      }\n    ]\n  },\n  {\n    path: '/login',\n    name: 'login',\n    component: () => import('../views/Login.vue')\n  }\n]\n\nconst router = new VueRouter({\n  mode: 'history',\n  base: process.env.BASE_URL,\n  routes\n})\n\nrouter.beforeEach(((to, from, next) => {\n  let hasRoute = store.state.menus.hasRoute\n\n  let token = localStorage.getItem(\"token\")\n  if (to.path == '/login') {\n    next()\n  } else if(!token) {\n    next({path: '/login'})\n  } else if(token && !hasRoute){\n    axios.get(\"/sys/menu/nav\",{\n      headers: {\n        Authorization: localStorage.getItem(\"token\")\n      }\n    }).then(res => {\n      //拿到menuList\n      store.commit(\"setMenuList\",res.data.data.nav)\n      //拿到用户权限，用于按钮的点击\n      store.commit(\"setPermList\",res.data.data.authorities)\n\n      //动态绑定路由\n      let newRoutes = router.options.routes\n\n      res.data.data.nav.forEach(menu => {\n        if (menu.children) {\n          menu.children.forEach(e => {\n            //转换成路由\n            let route = menuToRoute(e)\n            //把路由添加到路由管理中\n            if(route) {\n              newRoutes[0].children.push(route)\n            }\n          })\n        }\n      })\n      router.addRoutes(newRoutes)\n      hasRoute = true\n      store.commit(\"changeRouteStatus\",hasRoute)\n    }).catch(err => {\n      console.log(err)\n    })\n  }\n\n  next()\n}))\n\nconst menuToRoute = (menu) => {\n  if(!menu.component) {\n    return null\n  }\n\n  let route = {\n    name: menu.name,\n    path: menu.path,\n    meta: {\n      icon: menu.icon,\n      title: menu.title\n    }\n  }\n\n  route.component = () => import('@/views/'+ menu.component + '.vue');\n  return route\n}\n\nexport default router\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}